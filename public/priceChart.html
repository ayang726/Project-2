<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Price Chart</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

    <script>
        let dataSets = [];
        function oneDayFn(myLabel) {
            dataSets = [];
            dataSetsLabel = [];
            const btnElem = document.getElementById("OneDayID");
            //var axios = require("axios");
            //https://sandbox.iexapis.com/stable/stock/AAPL/chart/1m?token=Tpk_d1e0d015368c4061af98937e274f629b
            // Then run a request with axios to the OMDB API with the movie specified

            const requestURL = "https://sandbox.iexapis.com/stable/stock/AAPL/intraday-prices?token=Tpk_d1e0d015368c4061af98937e274f629b";
            //const requestURL = "https://sandbox.iexapis.com/stable/stock/AAPL/chart/1m?token=Tpk_d1e0d015368c4061af98937e274f629b";
            // axios.get(requestURL).then(
            //     function (response) {
            //         console.log("RESPONSE DATA: " + response.data);
            //     }
            // );
            //myChart.data.datasets = [];
            $.ajax({
                url: requestURL,
                type: 'GET',
                success: function (res) {
                    //console.log(res);
                    for (var i = 0; i < res.length; i++) {
                        const dataObj = res[i];
                        const volData = dataObj.average;
                        const labelValue = dataObj.label;
                        if (!dataSetsLabel.includes(labelValue)) {
                            dataSetsLabel.push(labelValue);
                        }
                        const volNum = parseInt(volData);
                        console.log("volData:[" + i + "]: " + volNum);
                        if (!isNaN(volNum)) {
                            dataSets.push(volNum);
                            //myChart.data.datasets[0].data.push(volNum);
                        }
                        //dataSets.push(dataObj.volume);
                        //console.log("dataObj[" + i + "] Volume:" + dataObj.volume);
                    }
                    ctx = document.getElementById('myChart').getContext('2d');
                    myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dataSetsLabel,
                            datasets: [{
                                label: 'Average Price',
                                data: dataSets,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)',
                                    'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            }
                        }
                    });
                }
            });

        }
    </script>

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-12-md">
                <h1>Price Chart</h1>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12-md">
                <a href="#" class="list-group-item list-group-item-action">AAPL
                    <div class="d-flex w-100 justify-content-between">
                        <h3 class="mb-1">$1,010.60</h3>
                        <p class="mb-1">+$0.15 (0.01%) <small class="text-muted">Today</small></p>
                        <p class="mb-1">-$0.09 (-0.01%) <small class="text-muted">After Hours</small></p>
                </a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12-md">
                <canvas id="myChart" width="450" height="450"></canvas>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12-md">
                <button type="button" id="OneDayID" onClick="oneDayFn()" class="btn btn-primary">1D</button>
                <button type="button" id="OneWeekID" class="btn btn-secondary">1W</button>
                <button type="button" id="OneMonthID" class="btn btn-success">1M</button>
                <button type="button" id="ThreeMonthID" class="btn btn-warning">3M</button>
                <button type="button" id="AllID" class="btn btn-danger">ALL</button>
            </div>
        </div>
    </div>
</body>

</html>

<script src="/js/priceChart.js"></script>

<script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: 'Average Price',
                data: [],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

</script>